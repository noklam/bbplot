---
toc: true 
title: "Recreating the BBC style graphic in Python - `plotnine` and `altair`"

keywords: fastai
sidebar: home_sidebar

summary: "Want to make awesome chart with bbc style? This is an attempt to reproduce https://bbc.github.io/rcookbook/ in python."
description: "Want to make awesome chart with bbc style? This is an attempt to reproduce https://bbc.github.io/rcookbook/ in python."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs\01_bbc_plot_with_plotnine_and_altair.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Todo">Todo<a class="anchor-link" href="#Todo"> </a></h1><ul>
<li>[ ] Missing Subtitle (plotnine)</li>
<li>[ ] Missing Style</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>plotnine</code> is an implementation of <code>ggplot</code> in python, while <code>altair</code> is base on <code>vega-lite</code>. Pick one that sparks joy.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Difference-between-plotnine-and-ggplot">Difference between plotnine and ggplot<a class="anchor-link" href="#Difference-between-plotnine-and-ggplot"> </a></h1><p>90% of them are the same, except that in python you have to wrap column names in <code>''</code>, otherwise it will be treated as variable and caused error. Most of the time you just need to wrap a <code>''</code> or replaced with <code>_</code> depends on the function.</p>
<p>Some of the features are missing in plotnine, for example, subtitle is not possible.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I tried to produce the same chart with <code>plotnine</code> and <code>altair</code>, and hopefully you will see their difference. <code>plotnine</code> covers 99% of <code>ggplot2</code>, so if you are coming from R, just go ahead with <code>plotnine</code>! <code>altair</code> is another interesting visualization library that base on vega-lite, therefore it can be integrated with website easily. In addition, it can also produce interactive chart with very simple function, which is a big plus!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Setup">Setup<a class="anchor-link" href="#Setup"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># collapse-hide</span>
<span class="c1"># !pip install plotnine[all]</span>
<span class="c1"># !pip install altair</span>
<span class="c1"># !pip install gapminder</span>


<span class="kn">from</span> <span class="nn">gapminder</span> <span class="k">import</span> <span class="n">gapminder</span>
<span class="kn">from</span> <span class="nn">plotnine.data</span> <span class="k">import</span> <span class="n">mtcars</span>
<span class="kn">from</span> <span class="nn">plotnine</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">plotnine</span> <span class="k">import</span> <span class="n">ggplot</span><span class="p">,</span> <span class="n">geom_point</span><span class="p">,</span> <span class="n">aes</span><span class="p">,</span> <span class="n">stat_smooth</span><span class="p">,</span> <span class="n">facet_wrap</span><span class="p">,</span> <span class="n">geom_line</span>
<span class="kn">from</span> <span class="nn">plotnine</span> <span class="k">import</span> <span class="n">ggplot</span>  <span class="c1"># https://plotnine.readthedocs.io/en/stable/</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotnine</span>

<span class="kn">from</span> <span class="nn">bbc_plot.bbc_plot</span> <span class="k">import</span> <span class="n">bbc_style</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
<span class="n">alt</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-intense-fg ansi-bold">----------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">ModuleNotFoundError</span>Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">&lt;ipython-input-1-f7c2a2809e0b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">     14</span> <span class="ansi-green-intense-fg ansi-bold">import</span> plotnine
<span class="ansi-green-fg">     15</span> 
<span class="ansi-green-intense-fg ansi-bold">---&gt; 16</span><span class="ansi-yellow-intense-fg ansi-bold"> </span><span class="ansi-green-intense-fg ansi-bold">from</span> bbc_plot<span class="ansi-yellow-intense-fg ansi-bold">.</span>bbc_plot <span class="ansi-green-intense-fg ansi-bold">import</span> bbc_style
<span class="ansi-green-fg">     17</span> get_ipython<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>run_line_magic<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;matplotlib&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;inline&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     18</span> get_ipython<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>run_line_magic<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;config&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#34;InlineBackend.figure_format = &#39;retina&#39;&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-intense-fg ansi-bold">ModuleNotFoundError</span>: No module named &#39;bbc_plot&#39;</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;altair version: </span><span class="si">{alt.__version__}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;plotnine version: </span><span class="si">{plotnine.__version__}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;pandas version: </span><span class="si">{pd.__version__}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Make-a-Line-Chart">Make a Line Chart<a class="anchor-link" href="#Make-a-Line-Chart"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="c1"># ggplot</span>
<span class="n">line_df</span> <span class="o">&lt;-</span> <span class="n">gapminder</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="n">country</span> <span class="o">==</span> <span class="s">&quot;Malawi&quot;</span><span class="p">)</span> 

<span class="c1">#Make plot</span>
<span class="n">line</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">line_df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">year</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lifeExp</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="s">&quot;#1380A1&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s">&quot;#333333&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">bbc_style</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Living longer&quot;</span><span class="p">,</span>
       <span class="n">subtitle</span> <span class="o">=</span> <span class="s">&quot;Life expectancy in Malawi 1952-2007&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">line_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">))</span> <span class="o">+</span>
 <span class="n">geom_line</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s1">&#39;#1380A1&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
 <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s1">&#39;#333333&#39;</span><span class="p">)</span> <span class="o">+</span>
 <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Living longer&#39;</span><span class="p">,</span> 
     <span class="n">subtitle</span> <span class="o">=</span> <span class="s1">&#39;Life expectancy in Malawi 1952-2007&#39;</span><span class="p">)</span>
 <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">## altair</span>
<span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">line_df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
<span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
<span class="n">y</span><span class="o">=</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">)</span>
<span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;Living Longer&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;subtitle&#39;</span><span class="p">:</span> <span class="s1">&#39;Life expectancy in Malawi 1952-2007&#39;</span><span class="p">})</span>
<span class="p">)</span> 

<span class="c1"># hline</span>
<span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
<span class="n">hline</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">overlay</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#333333&#39;</span><span class="p">,</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;y:Q&#39;</span><span class="p">)</span>

<span class="n">line</span> <span class="o">+</span> <span class="n">hline</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="The-BBC-style">The BBC style<a class="anchor-link" href="#The-BBC-style"> </a></h1><div class="highlight"><pre><span></span><span class="nf">function </span><span class="p">()</span> 
<span class="p">{</span>
    <span class="n">font</span> <span class="o">&lt;-</span> <span class="s">&quot;Helvetica&quot;</span>
    <span class="n">ggplot2</span><span class="o">::</span><span class="nf">theme</span><span class="p">(</span><span class="n">plot.title</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_text</span><span class="p">(</span><span class="n">family</span> <span class="o">=</span> <span class="n">font</span><span class="p">,</span> 
    <span class="n">size</span> <span class="o">=</span> <span class="m">28</span><span class="p">,</span> <span class="n">face</span> <span class="o">=</span> <span class="s">&quot;bold&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;#222222&quot;</span><span class="p">),</span> <span class="n">plot.subtitle</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_text</span><span class="p">(</span><span class="n">family</span> <span class="o">=</span> <span class="n">font</span><span class="p">,</span> 
    <span class="n">size</span> <span class="o">=</span> <span class="m">22</span><span class="p">,</span> <span class="n">margin</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">margin</span><span class="p">(</span><span class="m">9</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">0</span><span class="p">)),</span> <span class="n">plot.caption</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_blank</span><span class="p">(),</span> 
    <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;top&quot;</span><span class="p">,</span> <span class="n">legend.text.align</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">legend.background</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_blank</span><span class="p">(),</span> 
    <span class="n">legend.title</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_blank</span><span class="p">(),</span> <span class="n">legend.key</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_blank</span><span class="p">(),</span> 
    <span class="n">legend.text</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_text</span><span class="p">(</span><span class="n">family</span> <span class="o">=</span> <span class="n">font</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">18</span><span class="p">,</span> 
        <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;#222222&quot;</span><span class="p">),</span> <span class="n">axis.title</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_blank</span><span class="p">(),</span> 
    <span class="n">axis.text</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_text</span><span class="p">(</span><span class="n">family</span> <span class="o">=</span> <span class="n">font</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">18</span><span class="p">,</span> 
        <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;#222222&quot;</span><span class="p">),</span> <span class="n">axis.text.x</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_text</span><span class="p">(</span><span class="n">margin</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">margin</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> 
        <span class="n">b</span> <span class="o">=</span> <span class="m">10</span><span class="p">)),</span> <span class="n">axis.ticks</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_blank</span><span class="p">(),</span> 
    <span class="n">axis.line</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_blank</span><span class="p">(),</span> <span class="n">panel.grid.minor</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_blank</span><span class="p">(),</span> 
    <span class="n">panel.grid.major.y</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_line</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s">&quot;#cbcbcb&quot;</span><span class="p">),</span> 
    <span class="n">panel.grid.major.x</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_blank</span><span class="p">(),</span> <span class="n">panel.background</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_blank</span><span class="p">(),</span> 
    <span class="n">strip.background</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&quot;white&quot;</span><span class="p">),</span> 
    <span class="n">strip.text</span> <span class="o">=</span> <span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">22</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">0</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="n">namespace</span><span class="o">:</span><span class="n">bbplot</span><span class="o">&gt;</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">font</span> <span class="o">=</span> <span class="s2">&quot;Helvetica&quot;</span>
<span class="n">theme</span><span class="p">(</span><span class="n">plot_title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
                                      <span class="n">size</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#222222&quot;</span><span class="p">),</span>
              <span class="c1">#       plot_subtitle=element_text(family=font,</span>
              <span class="c1">#                                  size=22, plot_margin=(9, 0, 9, 0)), plot_caption=element_blank(),</span>
              <span class="n">legend_position</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">legend_title_align</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">legend_background</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span>
              <span class="n">legend_title</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span> <span class="n">legend_key</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span>
              <span class="n">legend_text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                                       <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#222222&quot;</span><span class="p">),</span> <span class="n">axis_title</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span>

              <span class="n">axis_text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#222222&quot;</span><span class="p">),</span>
              <span class="n">axis_text_x</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}),</span>
              <span class="n">axis_ticks</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span>
              <span class="n">axis_line</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span> <span class="n">panel_grid_minor</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span>
              <span class="n">panel_grid_major_y</span><span class="o">=</span><span class="n">element_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#cbcbcb&quot;</span><span class="p">),</span>
              <span class="n">panel_grid_major_x</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span> <span class="n">panel_background</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span>
              <span class="n">strip_background</span><span class="o">=</span><span class="n">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">),</span>
              <span class="n">strip_text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">hjust</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
              <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>finalise_plot()</code> function does more than just save out your chart, it also left-aligns the title and subtitle as is standard for BBC graphics, adds a footer with the logo on the right side and lets you input source text on the left side.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># altair</span>
<span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">line_df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
<span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
<span class="n">y</span><span class="o">=</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">)</span>
<span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;Living Longer&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;subtitle&#39;</span><span class="p">:</span> <span class="s1">&#39;Life expectancy in China 1952-2007&#39;</span><span class="p">})</span>
<span class="p">)</span> 

<span class="c1"># hline</span>
<span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
<span class="n">hline</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">overlay</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#333333&#39;</span><span class="p">,</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;lifeExp:Q&#39;</span><span class="p">)</span>

<span class="n">line</span> <span class="o">+</span> <span class="n">hline</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Make-a-multiple-line-chart">Make a multiple line chart<a class="anchor-link" href="#Make-a-multiple-line-chart"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="c1"># ggplot</span>
<span class="c1">#Prepare data</span>
<span class="n">multiple_line_df</span> <span class="o">&lt;-</span> <span class="n">gapminder</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="n">country</span> <span class="o">==</span> <span class="s">&quot;China&quot;</span> <span class="o">|</span> <span class="n">country</span> <span class="o">==</span> <span class="s">&quot;United States&quot;</span><span class="p">)</span> 

<span class="c1">#Make plot</span>
<span class="n">multiple_line</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">multiple_line_df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">year</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lifeExp</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">country</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s">&quot;#333333&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_colour_manual</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;#FAAB18&quot;</span><span class="p">,</span> <span class="s">&quot;#1380A1&quot;</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">bbc_style</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Living longer&quot;</span><span class="p">,</span>
       <span class="n">subtitle</span> <span class="o">=</span> <span class="s">&quot;Life expectancy in China and the US&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Make plot</span>
<span class="n">multiline</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">multiline_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s1">&#39;country&#39;</span><span class="p">))</span> <span class="o">+</span>
    <span class="n">geom_line</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">&quot;#1380A1&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#333333&quot;</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">scale_colour_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;#FAAB18&quot;</span><span class="p">,</span> <span class="s2">&quot;#1380A1&quot;</span><span class="p">])</span> <span class="o">+</span>
      <span class="n">bbc_style</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Living longer&quot;</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="s2">&quot;Life expectancy in China 1952-2007&quot;</span><span class="p">))</span>
<span class="n">multiline</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">multiline_altair</span> <span class="o">=</span> <span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">multiline_df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
<span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
<span class="n">y</span><span class="o">=</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">,</span>
<span class="n">color</span><span class="o">=</span><span class="s1">&#39;country&#39;</span><span class="p">)</span>
<span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;Living Longer&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;subtitle&#39;</span><span class="p">:</span> <span class="s1">&#39;Life expectancy in China 1952-2007&#39;</span><span class="p">})</span>
<span class="p">)</span> 

<span class="c1"># hline</span>
<span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
<span class="n">hline</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">overlay</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#333333&#39;</span><span class="p">,</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;lifeExp:Q&#39;</span><span class="p">)</span>

<span class="n">multiline_altair</span> <span class="o">+</span> <span class="n">hline</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Make-a-bar-chart">Make a bar chart<a class="anchor-link" href="#Make-a-bar-chart"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="c1"># ggplot</span>
<span class="c1">#Prepare data</span>
<span class="n">bar_df</span> <span class="o">&lt;-</span> <span class="n">gapminder</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="n">year</span> <span class="o">==</span> <span class="m">2007</span> <span class="o">&amp;</span> <span class="n">continent</span> <span class="o">==</span> <span class="s">&quot;Africa&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">lifeExp</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">head</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>

<span class="c1">#Make plot</span>
<span class="n">bars</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">bar_df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">country</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lifeExp</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s">&quot;identity&quot;</span><span class="p">,</span> 
           <span class="n">position</span><span class="o">=</span><span class="s">&quot;identity&quot;</span><span class="p">,</span> 
           <span class="n">fill</span><span class="o">=</span><span class="s">&quot;#1380A1&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s">&quot;#333333&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">bbc_style</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Reunion is highest&quot;</span><span class="p">,</span>
       <span class="n">subtitle</span> <span class="o">=</span> <span class="s">&quot;Highest African life expectancy, 2007&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">## hide</span>
<span class="n">bar_df</span> <span class="o">=</span> <span class="n">gapminder</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39; year == 2007 &amp; continent == &quot;Africa&quot; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;lifeExp&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bars_ggplot</span> <span class="o">=</span> <span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">bar_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">))</span> <span class="o">+</span>
  <span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">,</span>
           <span class="n">position</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">,</span>
           <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;#1380A1&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;#333333&quot;</span><span class="p">)</span> <span class="o">+</span>
<span class="c1">#   bbc_style() +</span>
  <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Reunion is highest&quot;</span><span class="p">,</span>
       <span class="n">subtitle</span><span class="o">=</span><span class="s2">&quot;Highest African life expectancy, 2007&quot;</span><span class="p">))</span>

<span class="n">bars_ggplot</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bars_altair</span> <span class="o">=</span> <span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">bar_df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
<span class="n">x</span><span class="o">=</span><span class="s1">&#39;country&#39;</span><span class="p">,</span>
<span class="n">y</span><span class="o">=</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">,</span>
<span class="c1"># color=&#39;country&#39;</span>
<span class="p">)</span>
<span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;Reunion is highest&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;subtitle&#39;</span><span class="p">:</span> <span class="s1">&#39;Highest African life expectancy, 2007&#39;</span><span class="p">})</span>
<span class="p">)</span> 

<span class="n">bars_altair</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Make-a-stacked-bar-chart">Make a stacked bar chart<a class="anchor-link" href="#Make-a-stacked-bar-chart"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">## collapse-hide</span>
<span class="n">stacked_bar_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">gapminder</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39; year == 2007&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">lifeExpGrouped</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
            <span class="n">x</span><span class="p">[</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">],</span>
            <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;under 50&quot;</span><span class="p">,</span> <span class="s2">&quot;50-65&quot;</span><span class="p">,</span> <span class="s2">&quot;65-80&quot;</span><span class="p">,</span> <span class="s2">&quot;80+&quot;</span><span class="p">]))</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="s1">&#39;lifeExpGrouped&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="s1">&#39;continentPop&#39;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">stacked_bar_df</span><span class="p">[</span><span class="s1">&#39;lifeExpGrouped&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">stacked_bar_df</span><span class="p">[</span><span class="s1">&#39;lifeExpGrouped&#39;</span><span class="p">],</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">stacked_bar_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="c1"># ggplot</span>
<span class="c1">#prepare data</span>
<span class="n">stacked_df</span> <span class="o">&lt;-</span> <span class="n">gapminder</span> <span class="o">%&gt;%</span> 
  <span class="nf">filter</span><span class="p">(</span><span class="n">year</span> <span class="o">==</span> <span class="m">2007</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">lifeExpGrouped</span> <span class="o">=</span> <span class="nf">cut</span><span class="p">(</span><span class="n">lifeExp</span><span class="p">,</span> 
                    <span class="n">breaks</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="m">65</span><span class="p">,</span> <span class="m">80</span><span class="p">,</span> <span class="m">90</span><span class="p">),</span>
                    <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;Under 50&quot;</span><span class="p">,</span> <span class="s">&quot;50-65&quot;</span><span class="p">,</span> <span class="s">&quot;65-80&quot;</span><span class="p">,</span> <span class="s">&quot;80+&quot;</span><span class="p">)))</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">,</span> <span class="n">lifeExpGrouped</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">summarise</span><span class="p">(</span><span class="n">continentPop</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">pop</span><span class="p">)))</span>

<span class="c1">#set order of stacks by changing factor levels</span>
<span class="n">stacked_df</span><span class="o">$</span><span class="n">lifeExpGrouped</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="n">stacked_df</span><span class="o">$</span><span class="n">lifeExpGrouped</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">rev</span><span class="p">(</span><span class="nf">levels</span><span class="p">(</span><span class="n">stacked_df</span><span class="o">$</span><span class="n">lifeExpGrouped</span><span class="p">)))</span>

<span class="c1">#create plot</span>
<span class="n">stacked_bars</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">stacked_df</span><span class="p">,</span> 
                       <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">continent</span><span class="p">,</span>
                           <span class="n">y</span> <span class="o">=</span> <span class="n">continentPop</span><span class="p">,</span>
                           <span class="n">fill</span> <span class="o">=</span> <span class="n">lifeExpGrouped</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">(</span><span class="n">stat</span> <span class="o">=</span> <span class="s">&quot;identity&quot;</span><span class="p">,</span> 
           <span class="n">position</span> <span class="o">=</span> <span class="s">&quot;fill&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">bbc_style</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="n">percent</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_fill_viridis_d</span><span class="p">(</span><span class="n">direction</span> <span class="o">=</span> <span class="m">-1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&quot;#333333&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">&quot;How life expectancy varies&quot;</span><span class="p">,</span>
       <span class="n">subtitle</span> <span class="o">=</span> <span class="s">&quot;% of population by life expectancy band, 2007&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;top&quot;</span><span class="p">,</span> 
        <span class="n">legend.justification</span> <span class="o">=</span> <span class="s">&quot;left&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">guides</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="nf">guide_legend</span><span class="p">(</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># altair</span>
<span class="n">stacked_bar_altair</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">stacked_bar_df</span><span class="p">)</span>
    <span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;continent:N&#39;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;continentPop&#39;</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s1">&#39;normalize&#39;</span><span class="p">,</span>
                    <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">),</span>
                   <span class="n">sort</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;80+&#39;</span><span class="p">,</span> <span class="s1">&#39;65-80&#39;</span><span class="p">,</span> <span class="s1">&#39;50-65&#39;</span><span class="p">,</span> <span class="s1">&#39;under 50&#39;</span><span class="p">]),</span>
<span class="c1">#                 order=alt.Order(</span>
<span class="c1">#       # Sort the segments of the bars by this field</span>
<span class="c1">#       &#39;lifeExpGrouped&#39;,</span>
<span class="c1">#       sort=&#39;descending&#39;),</span>
            <span class="n">fill</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Fill</span><span class="p">(</span><span class="s1">&#39;lifeExpGrouped:O&#39;</span><span class="p">,</span>
                          <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                                          <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                          <span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;under 50&#39;</span><span class="p">,</span><span class="s1">&#39;50-65&#39;</span><span class="p">,</span> <span class="s1">&#39;65-80&#39;</span><span class="p">,</span> <span class="s1">&#39;80+&#39;</span><span class="p">,</span> <span class="p">],</span>
                                         <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rgb(253, 231, 37)&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;rgb(53, 183, 121)&#39;</span><span class="p">,</span>
 <span class="s1">&#39;rgb(49, 104, 142)&#39;</span><span class="p">,</span>
 
 <span class="s1">&#39;rgb(68, 1, 84)&#39;</span><span class="p">]),</span>
                          <span class="n">legend</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Life Expectancy&quot;</span><span class="p">)</span>
                         
                         <span class="p">)</span>
           <span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;How life expectancy varies&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;subtitle&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f population by life expectancy band, 2007&#39;</span><span class="p">},</span>
                <span class="p">)</span>
<span class="p">)</span>

<span class="n">overay</span> <span class="o">=</span> <span class="n">overlay</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;continentPop&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
<span class="n">hline</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">overlay</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#333333&#39;</span><span class="p">,</span> <span class="n">strokeWidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;continentPop:Q&#39;</span><span class="p">)</span>


<span class="p">(</span><span class="n">stacked_bar_altair</span> <span class="o">+</span> <span class="n">hline</span><span class="p">)</span><span class="o">.</span><span class="n">configure_legend</span><span class="p">(</span><span class="n">orient</span> <span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Make-a-grouped-bar-chart">Make a grouped bar chart<a class="anchor-link" href="#Make-a-grouped-bar-chart"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="c1"># ggplot</span>
<span class="c1">#Prepare data</span>
<span class="n">grouped_bar_df</span> <span class="o">&lt;-</span> <span class="n">gapminder</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="n">year</span> <span class="o">==</span> <span class="m">1967</span> <span class="o">|</span> <span class="n">year</span> <span class="o">==</span> <span class="m">2007</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">select</span><span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">lifeExp</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">spread</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">lifeExp</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">gap</span> <span class="o">=</span> <span class="n">`2007`</span> <span class="o">-</span> <span class="n">`1967`</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">gap</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">head</span><span class="p">(</span><span class="m">5</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">gather</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="n">year</span><span class="p">,</span> 
         <span class="n">value</span> <span class="o">=</span> <span class="n">lifeExp</span><span class="p">,</span>
         <span class="o">-</span><span class="n">country</span><span class="p">,</span>
         <span class="o">-</span><span class="n">gap</span><span class="p">)</span> 

<span class="c1">#Make plot</span>
<span class="n">grouped_bars</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">grouped_bar_df</span><span class="p">,</span> 
                       <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">country</span><span class="p">,</span> 
                           <span class="n">y</span> <span class="o">=</span> <span class="n">lifeExp</span><span class="p">,</span> 
                           <span class="n">fill</span> <span class="o">=</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s">&quot;identity&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s">&quot;dodge&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s">&quot;#333333&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">bbc_style</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;#1380A1&quot;</span><span class="p">,</span> <span class="s">&quot;#FAAB18&quot;</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;We&#39;re living longer&quot;</span><span class="p">,</span>
       <span class="n">subtitle</span> <span class="o">=</span> <span class="s">&quot;Biggest life expectancy rise, 1967-2007&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># plotnine</span>
<span class="n">grouped_bars_ggplot</span> <span class="o">=</span> <span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">grouped_bar_df</span><span class="p">,</span>
                       <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;country&#39;</span><span class="p">,</span>
                           <span class="n">y</span><span class="o">=</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">,</span>
                           <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">))</span> <span class="o">+</span>
                <span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;dodge&quot;</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;#333333&quot;</span><span class="p">)</span> <span class="o">+</span>
<span class="c1">#                 bbc_style() +</span>
                <span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;#1380A1&quot;</span><span class="p">,</span> <span class="s2">&quot;#FAAB18&quot;</span><span class="p">))</span> <span class="o">+</span>
                <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;We&#39;re living longer&quot;</span><span class="p">,</span>
                     <span class="n">subtitle</span><span class="o">=</span><span class="s2">&quot;Biggest life expectancy rise, 1967-2007&quot;</span><span class="p">))</span>

<span class="n">grouped_bars_ggplot</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># altair</span>
<span class="n">grouped_bars_altair</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">grouped_bar_df</span><span class="p">)</span>
    <span class="o">.</span><span class="n">mark_bar</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;year:N&#39;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;year:N&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span>
                <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;#1380A1&quot;</span><span class="p">,</span> <span class="s2">&quot;#FAAB18&quot;</span><span class="p">])),</span>
            <span class="n">column</span><span class="o">=</span><span class="s1">&#39;country:N&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s2">&quot;We&#39;re living longer&quot;</span><span class="p">,</span>
                       <span class="s1">&#39;subtitle&#39;</span><span class="p">:</span> <span class="s1">&#39;Biggest life expectancy rise, 1967-2007&#39;</span><span class="p">},</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">100</span>
                <span class="p">)</span><span class="o">.</span><span class="n">configure_facet</span><span class="p">(</span>
        <span class="n">spacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="c1">#         strokeWidth=1.0,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">configure_scale</span><span class="p">(</span>
        <span class="n">bandPaddingInner</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
        <span class="n">bandPaddingOuter</span><span class="o">=</span><span class="mf">0.4</span>
    <span class="p">)</span><span class="o">.</span><span class="n">configure_header</span><span class="p">(</span><span class="n">labelOrient</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                       <span class="n">labelPadding</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                       <span class="n">titleOrient</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">configure_axisX</span><span class="p">(</span>
        <span class="n">ticks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">configure_view</span><span class="p">(</span>
        <span class="n">stroke</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">grouped_bars_altair</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

